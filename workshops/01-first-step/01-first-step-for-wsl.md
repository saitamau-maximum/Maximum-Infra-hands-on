## この章でやること
- 環境構築をする
- 最初の動作確認をする

## とりあえずやりましょう……
……あなたはとある企業で働いています。

入社後しばらくは研修続きでそこまで負荷が高くなかったので、友人のNさんと2人でチャットアプリを作ってみることにしました。

バックエンドはGo、フロントエンドはReactをメインに据えています。

1ヶ月ほどして、あなたはそのアプリを完成させます。やったね！！

Nさんと一緒にはしゃいでいると、運悪くその様子を上司に見られてしまいます。

上司はあなたが作ったアプリを見ると、

>「いいUIしているね。うちの部署の連絡手段にしたいから、サーバーで動かせるようにしておいてくれない？」

と言い放ちました。

あなたはNさんと一緒にこのアプリをサーバーで問題なく動くようセットアップしなくてはならなくなりました。

まだ入ったばっかりなのに……

## まずはsshしましょう
上司にサーバーを提供してもらったので、あなたはまず自分のパソコンでそのサーバーを操作できるようにしなくてはいけません。

このような場合、sshコマンドでサーバーにログインするのが有効です。

`ssh`はSecure SHellが由来で、リモートホスト（ネットワーク経由でアクセスできるパソコン）にログインすることができます。リモートホストに接続する他のコマンドとして`telnet`が挙げられますが、`ssh`では通信内容が暗号化されるため、こちらのほうが安全です。

早速リモートホストにログインしてみましょう。
```bash
ssh -l [ログインするユーザー名] [IPアドレス]
```
例
```bash
ssh -l ubuntu 192.168.123.8
```
コマンドを入れると、パスワードが求められるかと思うので、ログインしましょう。途中で出てくる質問には`yes`と答えましょう。

## 必要なものをinstallしないと始まらない
sshを無事に済ませたら、次にこのリポジトリのコードを持ってこなくてはなりません。

せっかく今までgithubを使ってきたので、上司からもらったサーバーにgitを入れることでカンタンにコードを持ってこられないか、とあなたは考えました。

ではまず、gitをインストールしましょう。
```bash
sudo apt update
sudo apt install -y git
```
インストールできたら、早速このリポジトリをクローンしましょう。

```bash
git clone https://github.com/saitamau-maximum/Maximum-Infra-hands-on.git
```

次に、フロントエンドを開発するためにnvmを、バックエンドを開発するためにGoをinstallしましょう。

nvmのinstall
```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
source ~/.bashrc
nvm install --lts
```

ここまでできたら、
```bash
cd ~/Maximum-Infra-hands-on/frontend
npm install
```
これで、フロントエンドの構築はOK。

次にバックエンドです

Goのinstallは、Ubuntuのバージョンなどによって異なるようなので、公式ページをご覧ください。

[https://go.dev/doc/install](https://go.dev/doc/install)

入れられたら、まずは変数をいじりましょう。

`backend/config/config.go`の、`CORSOrigin`のデフォルト値を変えてください。

例
```
CORSOrigin:  getEnv("CORS_ORIGIN", "http://localhost:5173"),
↓
CORSOrigin:  getEnv("CORS_ORIGIN", "http://192.168.123.8:5173"),
```
これができたら、次に動かす準備をします。
```bash
cd ~/Maximum-Infra-hands-on/backend
go mod tidy
go build
```
をしましょう。

ビルドの際にエラーを吐く場合があります。

gccの環境がないことが原因なことがあるので、

```bash
sudo apt install build-essential
```
で解決することがあります。

これでバックエンドの構築もOK。

これで環境構築はバッチリです。

## 動作確認


**もしVMを使っている場合、動かすためにはポートフォワーディングをする必要があります。**

sshトンネルでやります。

既にsshをしていると思いますが、一旦手元のPCに戻って（ログアウトして）から

```bash
ssh -L 8080:localhost:8080 -L 5173:localhost:5173 [user]@[IP]
```
で、フロントエンド、バックエンドのポートフォワーディングをしましょう。

（なぜこれで解決するのか・原因が何なのかは余白が足りないので割愛します。Hyper-VでWSLを動かして、そのうえでVMを動かしている入れ子構造が原因です。）

`~/Maximum-Infra-hands-on`で
```bash
bash ./script/start-dev
```
と実行してください。
そのIPアドレスの5173番ポートに訪れることで、アプリを見ることができます。

もし正しく開発環境が動いたら、最初のセットアップは成功です。

おめでとうございます。お疲れ様でした。